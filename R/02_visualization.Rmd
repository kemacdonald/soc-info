---
title: "SOC-INFO Visualization"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Setup

```{r}
library(knitr); library(magrittr); library(tidyverse); library(here)
theme_set(theme_minimal())
```

Read data. 

```{r}
d_path <- "data/02_tidy_data/"
d_file_name <- "goal_actions_ver2_tidy_pilot.csv"
d <- read_csv(here(d_path, d_file_name)) 
```

```{r}
d %<>% mutate(hypothesis_type = factor(hypothesis_type) %>% fct_rev(),
              hypothesis = factor(hypothesis) %>% fct_rev())
```

## Data checks

How many participants in each condition?

```{r}
d %>% 
  select(id, condition) %>% 
  unique() %>% 
  count(condition) %>% 
  kable()
```

## Table of comments

```{r}
d %>% 
  select(id, age, condition, about, comment) %>% 
  unique() %>% 
  arrange(condition) %>% 
  knitr::kable()
```

## Prior and posterior beliefs

Now summarise and plot.
  
```{r}  
d %>% 
  group_by(hypothesis_type, condition, hypothesis) %>% 
  summarise(m = mean(slider_value_normalized)) %>% 
  ggplot(aes(x = hypothesis, y = m, fill = condition)) +
  geom_bar(stat = "identity", width = 0.4, position = position_dodge()) +
  geom_hline(yintercept = 0.3, linetype = "dashed") +
  lims(y = c(0,0.55)) +
  #scale_fill_grey() +
  ggthemes::scale_fill_ptol() +
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        panel.border = element_rect(fill=NA, size=0.5, color = "grey")) +
  facet_wrap(~hypothesis_type)
```

## Action responses 

Plot counts of different action responses for the learning vs. performance goal conditions.

```{r}
d %>% 
  select(condition, action_response, id) %>% 
  unique() %>% 
  count(action_response, condition) %>% 
  group_by(condition) %>% 
  mutate(prop = n / sum(n)) %>% 
  ggplot(aes(x = action_response, y = prop, fill = condition)) +
  geom_bar(stat = "identity", width = 0.4, position = position_dodge()) +
  lims(y = c(0,1)) +
  ggthemes::scale_fill_ptol() +
  facet_grid(.~condition) +
  theme(panel.border = element_rect(fill=NA, size=0.5, color = "grey"))
```

Make a table of the raw counts.

```{r}
d %>% 
  select(condition, action_response, id) %>% 
  unique() %>% 
  count(action_response, condition) %>% 
  arrange(condition, action_response) %>% 
  knitr::kable()
```

## Experiment time distributions

Plot the distribution of overall time on the experiment across conditions.

```{r}
d %>% 
  select(id, experiment_time, condition) %>% 
  unique() %>% 
  ggplot(aes(x = condition, y = experiment_time / 60)) +
  geom_boxplot(width = 0.3) +
  lims(y = c(0,max(d$experiment_time / 60))) +
  labs(y = "Time (min)")
```

Make the same plot, but for the time spent on the action decision.

```{r}
d %>% 
  select(id, action_trial_time, condition) %>% 
  unique() %>% 
  ggplot(aes(x = action_trial_time)) +
  geom_histogram() + 
  labs(x = c("time (sec)")) +
  facet_wrap(~condition, ncol = 1) +
  theme(panel.border = element_rect(fill=NA, size=0.5, color = "grey"))
```

## Plot belief change

here we plot belief change as a function of condition and the action that participants chose.

```{r}
d %>% 
  ggplot(aes(x = hypothesis_type, y = slider_value_normalized, 
             color = action_response)) +
  geom_line(aes(group = id), size = 0.5) + 
  geom_jitter(width = 0, size = 2) +
  lims(y = c(0,1)) +
  labs(x = NULL, y = "Belief") + 
  facet_grid(hypothesis~condition) +
  ggthemes::scale_color_ptol() +
  theme(legend.position = "top",
        panel.border = element_rect(fill=NA, size=0.5, color = "grey"))
```
